{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "voice-input",
  "type": "registry:component",
  "title": "Voice Input",
  "description": "Compound voice input UI with record, cancel, and preview states.",
  "dependencies": [
    "class-variance-authority",
    "lucide-react",
    "motion"
  ],
  "registryDependencies": [
    "button",
    "skeleton"
  ],
  "files": [
    {
      "path": "registry/new-york/ui/voice-input.tsx",
      "content": "\"use client\";\n\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { MicIcon, SquareIcon, XIcon } from \"lucide-react\";\nimport { motion } from \"motion/react\";\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/registry/new-york/ui/button\";\nimport { Skeleton } from \"@/registry/new-york/ui/skeleton\";\n\nconst buttonVariants = cva(\"!px-0\", {\n  variants: {\n    size: {\n      default: \"h-9 w-9\",\n      sm: \"h-8 w-8\",\n      lg: \"h-10 w-10\",\n    },\n  },\n  defaultVariants: {\n    size: \"default\",\n  },\n});\n\ntype ButtonSize = VariantProps<typeof buttonVariants>[\"size\"];\n\nexport interface VoiceInputData {\n  /** The current partial (in-progress) transcript */\n  partialTranscript: string;\n  /** Array of all committed (finalized) transcripts */\n  committedTranscripts: string[];\n  /** Full transcript combining committed and partial transcripts */\n  transcript: string;\n}\n\ninterface VoiceInputContextValue {\n  isConnected: boolean;\n  isConnecting: boolean;\n  transcript: string;\n  partialTranscript: string;\n  committedTranscripts: string[];\n  error: string | null;\n  start: () => Promise<void> | void;\n  stop: () => Promise<void> | void;\n  cancel: () => Promise<void> | void;\n  size: ButtonSize;\n}\n\nconst VoiceInputContext = React.createContext<VoiceInputContextValue | null>(\n  null,\n);\n\nfunction useVoiceInput() {\n  const context = React.useContext(VoiceInputContext);\n  if (!context) {\n    throw new Error(\n      \"VoiceInput compound components must be used within a VoiceInput\",\n    );\n  }\n  return context;\n}\n\nfunction buildTranscript({\n  partialTranscript,\n  committedTranscripts,\n}: {\n  partialTranscript: string;\n  committedTranscripts: string[];\n}): string {\n  const committed = committedTranscripts.join(\" \").trim();\n  const partial = partialTranscript.trim();\n\n  return [committed, partial].filter(Boolean).join(\" \");\n}\n\nexport interface VoiceInputProps {\n  children: React.ReactNode;\n\n  /**\n   * Indicates whether the underlying speech service is currently connected/recording.\n   */\n  isConnected: boolean;\n\n  /**\n   * Indicates whether the speech service is in the process of connecting.\n   * @default false\n   */\n  isConnecting?: boolean;\n\n  /**\n   * Current partial (in-progress) transcript\n   * @default \"\"\n   */\n  partialTranscript?: string;\n\n  /**\n   * Array of finalized transcript segments\n   * @default []\n   */\n  committedTranscripts?: string[];\n\n  /**\n   * Full transcript. If omitted, it will be derived from committed + partial transcripts.\n   */\n  transcript?: string;\n\n  /**\n   * Error message surfaced by the host speech service (if any).\n   * @default null\n   */\n  error?: string | null;\n\n  /**\n   * Called when the record button triggers a start action.\n   */\n  onStart?: () => Promise<void> | void;\n\n  /**\n   * Called when the record button triggers a stop action.\n   */\n  onStop?: () => Promise<void> | void;\n\n  /**\n   * Called when the cancel button is pressed.\n   */\n  onCancel?: () => Promise<void> | void;\n\n  /**\n   * Additional CSS classes for the root container\n   */\n  className?: string;\n\n  /**\n   * Size variant for the component buttons\n   * @default \"default\"\n   */\n  size?: ButtonSize;\n}\n\nconst VoiceInput = React.forwardRef<HTMLDivElement, VoiceInputProps>(\n  function VoiceInput(\n    {\n      children,\n      className,\n      size = \"default\",\n      isConnected,\n      isConnecting = false,\n      partialTranscript = \"\",\n      committedTranscripts = [],\n      transcript,\n      error = null,\n      onStart,\n      onStop,\n      onCancel,\n    },\n    ref,\n  ) {\n    const noop = React.useCallback(() => {}, []);\n\n    const computedData = React.useMemo(() => {\n      const safeCommitted = committedTranscripts ?? [];\n      const safePartial = partialTranscript ?? \"\";\n\n      return {\n        partialTranscript: safePartial,\n        committedTranscripts: safeCommitted,\n        transcript:\n          transcript ??\n          buildTranscript({\n            partialTranscript: safePartial,\n            committedTranscripts: safeCommitted,\n          }),\n      };\n    }, [committedTranscripts, partialTranscript, transcript]);\n\n    const contextValue: VoiceInputContextValue = React.useMemo(\n      () => ({\n        isConnected,\n        isConnecting,\n        start: onStart ?? noop,\n        stop: onStop ?? noop,\n        cancel: onCancel ?? noop,\n        error: error ?? null,\n        size,\n        ...computedData,\n      }),\n      [\n        isConnected,\n        isConnecting,\n        onStart,\n        onStop,\n        onCancel,\n        error,\n        size,\n        computedData,\n        noop,\n      ],\n    );\n\n    return (\n      <VoiceInputContext.Provider value={contextValue}>\n        <div\n          ref={ref}\n          className={cn(\n            \"relative inline-flex items-center overflow-hidden rounded-md transition-all duration-200\",\n            isConnected\n              ? \"bg-background dark:bg-muted shadow-[inset_0_0_0_1px_var(--color-input),0_1px_2px_0_rgba(0,0,0,0.05)]\"\n              : \"\",\n            className,\n          )}\n        >\n          {children}\n        </div>\n      </VoiceInputContext.Provider>\n    );\n  },\n);\n\nVoiceInput.displayName = \"VoiceInput\";\n\nexport type VoiceInputRecordButtonProps = Omit<\n  React.ComponentPropsWithoutRef<typeof Button>,\n  \"size\"\n>;\n\n/**\n * Toggle button for starting/stopping speech recording.\n * Shows a microphone icon when idle and a stop icon when recording.\n */\nconst VoiceInputRecordButton = React.forwardRef<\n  HTMLButtonElement,\n  VoiceInputRecordButtonProps\n>(function VoiceInputRecordButton(\n  { className, onClick, variant = \"ghost\", disabled, ...props },\n  ref,\n) {\n  const voiceInput = useVoiceInput();\n\n  return (\n    <Button\n      ref={ref}\n      type=\"button\"\n      variant={variant}\n      onClick={(e) => {\n        if (voiceInput.isConnected) {\n          voiceInput.stop();\n        } else {\n          voiceInput.start();\n        }\n        onClick?.(e);\n      }}\n      disabled={disabled ?? voiceInput.isConnecting}\n      className={cn(\n        buttonVariants({ size: voiceInput.size }),\n        \"relative flex items-center justify-center transition-all\",\n        voiceInput.isConnected && \"scale-[80%]\",\n        className,\n      )}\n      aria-label={voiceInput.isConnected ? \"Stop recording\" : \"Start recording\"}\n      {...props}\n    >\n      <Skeleton\n        className={cn(\n          \"absolute h-4 w-4 rounded-full transition-all duration-200\",\n          voiceInput.isConnecting\n            ? \"bg-primary scale-90\"\n            : \"scale-[60%] bg-transparent\",\n        )}\n      />\n      <SquareIcon\n        className={cn(\n          \"text-destructive absolute h-4 w-4 fill-current transition-all duration-200\",\n          !voiceInput.isConnecting && voiceInput.isConnected\n            ? \"scale-100 opacity-100\"\n            : \"scale-[60%] opacity-0\",\n        )}\n      />\n      <MicIcon\n        className={cn(\n          \"absolute h-4 w-4 transition-all duration-200\",\n          !voiceInput.isConnecting && !voiceInput.isConnected\n            ? \"scale-100 opacity-100\"\n            : \"scale-[60%] opacity-0\",\n        )}\n      />\n    </Button>\n  );\n});\n\nVoiceInputRecordButton.displayName = \"VoiceInputRecordButton\";\n\nexport interface VoiceInputPreviewProps\n  extends React.ComponentPropsWithoutRef<\"div\"> {\n  /**\n   * Text to show when no transcript is available\n   * @default \"Listening...\"\n   */\n  placeholder?: string;\n\n  /**\n   * Which text to display in the preview.\n   * - \"full\": committed + partial transcript\n   * - \"partial\": only the current partial transcript\n   * @default \"partial\"\n   */\n  display?: \"full\" | \"partial\";\n}\n\n/**\n * Displays the current transcript with a placeholder when empty.\n * Only visible when actively recording.\n */\nconst VoiceInputPreview = React.forwardRef<\n  HTMLDivElement,\n  VoiceInputPreviewProps\n>(function VoiceInputPreview(\n  { className, placeholder = \"Listening...\", display = \"full\", ...props },\n  ref,\n) {\n  const voiceInput = useVoiceInput();\n  const previewText =\n    display === \"partial\"\n      ? voiceInput.partialTranscript\n      : voiceInput.transcript;\n  const [visiblePreview, setVisiblePreview] = React.useState(\"\");\n\n  React.useEffect(() => {\n    if (previewText.trim()) {\n      setVisiblePreview(previewText);\n    } else if (!voiceInput.isConnected) {\n      // Clear when not connected so next start shows placeholder again.\n      setVisiblePreview(\"\");\n    }\n  }, [previewText, voiceInput.isConnected]);\n\n  const showPlaceholder = !visiblePreview.trim() && voiceInput.isConnected;\n  const displayText =\n    visiblePreview || (voiceInput.isConnected ? placeholder : \"\");\n\n  return (\n    <div\n      ref={ref}\n      inert={voiceInput.isConnected ? undefined : true}\n      className={cn(\n        \"relative self-stretch text-sm transition-[opacity,transform,width] duration-200 ease-out\",\n        showPlaceholder\n          ? \"text-muted-foreground italic\"\n          : \"text-muted-foreground\",\n        voiceInput.isConnected ? \"w-28 opacity-100\" : \"w-0 opacity-0\",\n        className,\n      )}\n      title={displayText}\n      aria-hidden={!voiceInput.isConnected}\n      {...props}\n    >\n      <div className=\"absolute inset-y-0 -right-1 -left-1 [mask-image:linear-gradient(to_right,transparent,black_10px,black_calc(100%-10px),transparent)]\">\n        <motion.p\n          key=\"text\"\n          layout=\"position\"\n          className=\"absolute top-0 right-0 bottom-0 flex h-full min-w-full items-center px-1 whitespace-nowrap\"\n        >\n          {displayText}\n        </motion.p>\n      </div>\n    </div>\n  );\n});\n\nVoiceInputPreview.displayName = \"VoiceInputPreview\";\n\nexport type VoiceInputCancelButtonProps = Omit<\n  React.ComponentPropsWithoutRef<typeof Button>,\n  \"size\"\n>;\n\n/**\n * Button to cancel the current recording and discard the transcript.\n * Only visible when actively recording.\n */\nconst VoiceInputCancelButton = React.forwardRef<\n  HTMLButtonElement,\n  VoiceInputCancelButtonProps\n>(function VoiceInputCancelButton(\n  { className, onClick, variant = \"ghost\", ...props },\n  ref,\n) {\n  const voiceInput = useVoiceInput();\n\n  return (\n    <Button\n      ref={ref}\n      type=\"button\"\n      variant={variant}\n      inert={voiceInput.isConnected ? undefined : true}\n      onClick={(e) => {\n        voiceInput.cancel();\n        onClick?.(e);\n      }}\n      className={cn(\n        buttonVariants({ size: voiceInput.size }),\n        \"transition-[opacity,transform,width] duration-200 ease-out\",\n        voiceInput.isConnected\n          ? \"scale-[80%] opacity-100\"\n          : \"pointer-events-none w-0 scale-100 opacity-0\",\n        className,\n      )}\n      aria-label=\"Cancel recording\"\n      {...props}\n    >\n      <XIcon className=\"h-3 w-3\" />\n    </Button>\n  );\n});\n\nVoiceInputCancelButton.displayName = \"VoiceInputCancelButton\";\n\nexport {\n  useVoiceInput,\n  VoiceInput,\n  VoiceInputCancelButton,\n  VoiceInputPreview,\n  VoiceInputRecordButton,\n};\n",
      "type": "registry:component"
    }
  ]
}